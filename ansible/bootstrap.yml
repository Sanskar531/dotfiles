- name: Manage Dotfiles
  hosts: localhost
  become: no
  tasks:
    - name: Clone repo
      git:
        repo: 'https://github.com/Sanskar531/dotfiles.git'
        dest: '{{ ansible_env.HOME }}/dotfiles'
    - name: Install packages
      ansible.builtin.package:
        name:
          - neovim
          - tmux
          - zoxide
          - exa
          - ripgrep
          - git
          - fd
          - jq
          - yq
          - fzf
          - hyperfine
          - neofetch
          - starship
          - fish
          - pipx
        state: present
    - name: MacOS Dependencies
      include_tasks: ./mac.yml
      when: ansible_facts['os_family'] == 'Darwin'
    - name: Install additional packages for Linux
      include_tasks: ./linux.yml
      when: ansible_facts['os_family'] == 'Archlinux'
    - name: Ensure .config folder exists:
      ansible.builtin.file:
        path: '{{ ansible_env.HOME }}/.config'
        state: directory
    - name: Ensure fish folder exists:
      ansible.builtin.file:
        path: '{{ ansible_env.HOME }}/.config/fish'
        state: directory
    - name: Install Packer for neovim
      git:
        repo: 'https://github.com/wbthomason/packer.nvim'
        dest: '{{ ansible_env.HOME }}/.local/share/nvim/site/pack/packer/start/packer.nvim'
        depth: 1
    - name: Symlink starship
      file:
        src: '{{ ansible_env.HOME }}/dotfiles/starship.toml'
        dest: '{{ ansible_env.HOME }}/.config/starship.toml'
        state: link
    - name: Symlink fish
      file:
        src: '{{ ansible_env.HOME }}/dotfiles/config.fish'
        dest: '{{ ansible_env.HOME }}/.config/fish/config.fish'
        state: link
    - name: Symlink nvim
      file:
        src: '{{ ansible_env.HOME }}/dotfiles/nvim'
        dest: '{{ ansible_env.HOME }}/.config/nvim'
        state: link
    - name: Symlink alacritty
      file:
        src: '{{ ansible_env.HOME }}/dotfiles/alacritty'
        dest: '{{ ansible_env.HOME }}/.config/alacritty'
        state: link
    - name: Symlink tmux
      file:
        src: '{{ ansible_env.HOME }}/dotfiles/.tmux.conf'
        dest: '{{ ansible_env.HOME }}/.tmux.conf'
        state: link
    - name: Install neovim configs
      ansible.builtin.shell:
        cmd: is_bootstrap=true nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'
    - name: Install fisher
      ansible.builtin.shell:
        cmd: curl -sL https://raw.githubusercontent.com/jorgebucaran/fisher/main/functions/fisher.fish | source && fisher install jorgebucaran/fisher
    - name: Install pyenv
      ansible.builtin.shell:
        cmd: curl https://pyenv.run | bash
    - name: Install pyenv virtualenv
      ansible.builtin.shell:
        cmd: git clone https://github.com/pyenv/pyenv-virtualenv.git (pyenv root)/plugins/pyenv-virtualenv
